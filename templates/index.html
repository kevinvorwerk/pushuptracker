<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Push-up Tracker</title>
   <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

   <div class="header">
       <h1>Push-up Tracker</h1>
       <p>Logged in as: {{ session['username'] }}</p>
       <a href="/logout">Logout</a>
   </div>

   <div class="content-wrapper">

       <!-- Flash Messages Section -->
       {% with messages = get_flashed_messages() %}
           {% if messages %}
               <ul class="flashes">
                   {% for message in messages %}
                       <li>{{ message }}</li>
                   {% endfor %}
               </ul>
           {% endif %}
       {% endwith %}

       <form method="POST" action="/add">
           <h3>Add Entry</h3>
           <input type="date" name="date" value="{{ today }}" required>
           <input type="number" name="target" placeholder="Target" required>
           <input type="number" name="done" placeholder="Done" required>
           
           <button type="submit">Add</button>
       </form>
      
       <h3>Your Push-up Entries</h3>
       <ul>
           {% for entry in user_entries %}
               <li>
		   <p>
		   {{ entry[2] }} - Target: {{ entry[3] }} - Done: {{ entry[4] }} 
                   (User: {{ session['username'] }})
		   </p>
                   <form method="POST" action="/fix" style="display:inline;">
                       <input type="number" name="done" placeholder="Adjust Done">
                       <input type="hidden" name="date" value="{{ entry[2] }}">
                       <button type="submit">Fix</button>
                   </form>
		    <form method="POST" action="/delete_entry" style="display:inline;">
                       <input type="hidden" name="date" value="{{ entry[2] }}">
                       <input type="hidden" name="user_id" value="{{ entry[1] }}"> <!-- User ID for validation -->
                       <button type="submit">X</button>
                   </form>
               </li>
           {% endfor %}
       </ul>

       <h3>All Push-up Entries</h3>
       <ul>
           {% for entry in all_entries %}
               <li>User Name: {{ entry[5] }} - Date: {{ entry[2] }} - Target: {{ entry[3] }} - Done: {{ entry[4] }}
               </li>
           {% endfor %}
       </ul>


       <form method="POST" action="/select_user" style="text-align: center; margin: 20px auto;">
   <label for="selected_partner">Select User for Comparison:</label>
   <select id="selected_partner" name="selected_partner">
       <option value="">Select User</option>
       {% for user in all_users %}
           <option value="{{ user[0] }}"
               {% if user[0] == (selected_partner|int) %}
                   selected
               {% endif %}>
               {{ user[1] }}
           </option>
       {% endfor %}
   </select>
   <button type="submit">Show</button>
</form>

<form method="GET" action="/">
    <label for="start">Start Date:</label>
    <input type="date" id="start" name="start_date" value="{{ start_date }}">

    <label for="end">End Date:</label>
    <input type="date" id="end" name="end_date" value="{{ end_date }}">

    <button type="submit">Update</button>
</form>

<canvas id="pushupChart"></canvas>

<script>
   const ctx = document.getElementById('pushupChart').getContext('2d');

   const dataLabels = {{ data_range | tojson }};
   const userPushups = {{ user_pushups | tojson }};
   const targetPushups = {{ target_pushups | tojson }};
   const partnerPushups = {{ partner_pushups | tojson }};

   const data = {
       labels: dataLabels,
       datasets: [
       {
           label: 'Your Daily Push Ups',
           data: userPushups,
           borderColor: 'rgba(75, 192, 192, 1)',
           backgroundColor: 'rgba(75, 192, 192, 0.2)',
           borderWidth: 1
       }, 
       {
           label: 'Target Push Ups',
           data: targetPushups,
           borderColor: 'rgba(255, 205, 86, 1)',
           backgroundColor: 'rgba(255, 205, 86, 0.2)',
           borderWidth: 1,
           borderDash: [5, 5]  // Dashed line for target
       }, 
       {
           label: '{{ session["selected_partnername"] | default("Partner") }} Daily Push Ups',
           data: partnerPushups,
           borderColor: 'rgba(255, 99, 132, 1)',
           backgroundColor: 'rgba(255, 99, 132, 0.2)',
           borderWidth: 1
       }]
   };

   // Console logs for debugging
   console.log("Selected User ID: ", "{{ session['selected_partner'] }}");
   console.log("All Entries: ", {% if all_entries | length > 0 %}{{ all_entries | tojson }}{% else %}[]{% endif %}); // Print all entries
   console.log("Your Daily Push Ups: ", userPushups);
   console.log("Target Daily Push Ups: ", targetPushups);
   console.log("Partner Daily Push Ups: ", partnerPushups);
   
   console.log("Date Range:", dataLabels);

   const config = {
       type: 'bar',
       data: data,
       options: {
           responsive: true,
           scales: {
               y: {
                   beginAtZero: true,
                   ticks: {
                       stepSize: 1  // More compact on the Y-axis
                   }
               }
           }
       }
   };

   const pushupChart = new Chart(ctx, config);
</script>



   </div>

</body>
</html>
